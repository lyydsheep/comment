syntax = "proto3";

package comment.v1;

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "comment/api/comment/v1;v1";
option java_multiple_files = true;
option java_package = "dev.kratos.api.comment.v1";
option java_outer_classname = "CommentProtoV1";

// 评论服务定义
service CommentService {
  // 创建评论
  rpc CreateComment (CreateCommentRequest) returns (Comment) {
    option (google.api.http) = {
      post: "/api/v1/comment"
      body: "*"
    };
  }
}

message CreateCommentRequest {
  // 模块标识，用于区分不同业务模块
  // 例如: 1-文章, 2-视频, 3-商品等
  int32 module = 1;

  // 资源ID，关联的业务资源唯一标识
  // 例如: 文章ID、视频ID等
  string resource_id = 2;

  // 用户信息
  string user_id = 3;         // 用户系统中的唯一标识
  string username = 4;        // 显示用户名
  string avatar = 5;          // 用户头像图片URL

  // 评论内容，支持文本和表情
  string content = 6;

  // 评论层级关系
  int64 parent_comment_id = 7; // 父评论ID，0表示顶级评论
  int32 level = 8;             // 评论层级，0为顶级，子级依次递增
  int64 root_comment_id = 9;   // 根评论ID，用于快速查找整个评论链
}

// Comment 评论消息
// 包含评论的基本信息和回复列表
message Comment {
  // 业务模块标识
  int32 module = 1;

  // 资源唯一标识
  string resource_id = 2;

  // 评论唯一标识
  int64 comment_id = 3;

  // 用户相关字段
  string user_id = 4;         // 用户唯一标识
  string username = 5;        // 用户名
  string avatar = 6;          // 用户头像URL

  // 评论内容
  string content = 7;

  // 评论层级信息
  int32 level = 8;            // 评论层级（0为顶级评论）

  // 回复评论列表
  repeated Comment reply_comments = 9;

  // 评论时间
  google.protobuf.Timestamp create_time = 10;
}
